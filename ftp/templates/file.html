{% extends "base.html" %}
{% block content %}

<!-- 

  `Breadcrumb is currently broken`

  <div class="file-breadcrumb">
  {% set parts = dirpath.split('/') if dirpath else ['/'] %}
  {% set current_path = '' %}
  
  <a href="{{ url_for('directories.list_directory', dirpath='') }}" class="breadcrumb-link">
    <img src="{{ url_for('static', filename='icons/back2.svg') }}" alt="Back" class="breadcrumb-icon">
  </a>
  
  {% for part in parts %}
    {% if current_path %}
      {% set current_path = current_path ~ '/' ~ part %}
    {% else %}
      {% set current_path = part %}
    {% endif %}
    
    <a href="{{ url_for('directories.list_directory', dirpath=current_path) }}" class="breadcrumb-link">
      {{ part }}
    </a>
    
    {% if not loop.last %}
      <span class="breadcrumb-separator">/</span>
    {% endif %}
  {% endfor %}
</div> -->
<h1 class="file-title">{{ filename }}</h1>

<!-- <div class="file-actions">
  <button class="btn">Download</button>
  <button class="btn">Rename</button>
  <button class="btn">Delete</button>
  <button class="btn">Share</button>
</div> --> <!-- commented for now -->

<!-- Thant Htet Aung -->
<!-- Added a new tool "Go-Back" -->
<div class="go-back">
  {% set parent_dir = '' %}
  {% if '/' in filepath %}
      {% set parent_dir = filepath.rsplit('/', 1)[0] %}
  {% endif %}
  <a href="{{ url_for('directories.list_directory', dirpath=parent_dir) }}"
     class="btn go-back-btn">
    â¬… Go Back
  </a>
</div>

<!-- File Preview -->
{% if mime_type.startswith('image/') %}
<div class="file-preview file-preview-image">
  <img src="{{ url_for('directories.serve_file', filepath=filepath) }}" alt="{{ filename }}">
</div>

{% elif mime_type == 'application/pdf' %}
<div class="file-preview file-preview-pdf">
  <p id="pdf-loading-message">Loading PDF...</p>
  <iframe 
      src="{{ url_for('directories.serve_file', filepath=filepath) }}" 
      width="100%" 
      height="600px" 
      loading="lazy"
      onload="document.getElementById('pdf-loading-message').style.display='none';"
      title="{{ filename }}">
  </iframe>
</div>

{% elif mime_type.startswith('text/') %}
<div class="file-preview file-preview-text">
  {% if text_preview %}
    <pre><code class="language-{{ language }}">{{ text_preview | join('\n') }}</code></pre>
  {% else %}
    <pre><em>(empty file)</em></pre>
  {% endif %}
</div>

{% elif mime_type.startswith('application/json') %}
<div class="file-preview file-preview-json">
  {% if text_preview %}
    <pre>{{ text_preview | join('\n') }}</pre>
  {% else %}
    <pre><em>(empty JSON file)</em></pre>
  {% endif %}
</div>
{% elif mime_type.startswith('audio/') %}
<div class="file-preview file-preview-audio">
  <audio controls>
    <source src="{{ url_for('directories.serve_file', filepath=filepath) }}" type="{{ mime_type }}">
    Your browser does not support the audio element.
  </audio>
</div>

{% elif mime_type.startswith('video/') %}
<div class="file-preview file-preview-video">
  <video controls>
    <source src="{{ url_for('directories.serve_file', filepath=filepath) }}" type="{{ mime_type }}">
    Your browser does not support the video element.
  </video>
</div>

{% else %}
<div class="file-preview file-preview-unsupported">
  No preview available for this file type: {{ mime_type }}
</div>
{% endif %}

<!-- Metadata Table -->
<table class="file-meta">
  <tr>
    <th>File Name</th>
    <td>{{ filename }}</td>
  </tr>
  <tr>
    <th>Media type</th>
    <td>{{ mime_type or 'unknown' }}</td>
  </tr>
  <tr>
    <th>Size</th>
    <td>{{ size }} bytes</td>
  </tr>
  <tr>
    <th>Directory</th>
    <td>{{ dirpath or '/' }}</td> <!-- Broken -->
  </tr>
  <tr>
    <th>Created</th>
    <td>{{ created_at or '2025-09-15 12:00:00 - dummy data' }}</td> <!-- Construct a row in database -->
  </tr>
  <tr>
    <th>Last modified</th>
    <td>{{ modified_at or '2025-09-15 12:30:00 - dummy data' }}</td> <!-- Construct a row in database -->
  </tr>
</table>

{% endblock %}
